---
title: Secure Boot
description: Secure Boot.
---
import ImageComponent from "@components/ImageComponent.astro";
import ThemedImage from '@components/ThemedImage.astro';
import { Tabs, TabItem } from '@astrojs/starlight/components';
import { LinkCard, CardGrid } from '@astrojs/starlight/components';

**Secure Boot** is a UEFI feature that protects the system during startup by allowing only software components
(such as bootloaders, kernels, and drivers) that are *digitally signed* with trusted keys to run.
It prevents unauthorized or malicious code—like rootkits or modified bootloaders—from executing before the operating system starts.

When enabled, the firmware verifies each boot component against a trusted certificate database before loading it.
If a file is unsigned or tampered with, the firmware blocks it and displays a **Secure Boot violation** error.

Athena Arch supports Secure Boot in UEFI. Its deployment is managed automatically by Aegis installer that will detect if the system is UEFI and will create the proper certificates and sign the boot and kernel files needed for this process.

## Key Enrollment

The ISO Live Environment must be currently run with no Secure Boot. When Athena OS Arch-base is installed, the user must enable Secure Boot from BIOS settings.

At first reboot, it gets a **MOK (Machine Owner Key)** request for enrolling the Secure Boot certificate previously created for you by Aegis.

![MOK](@assets/images/mok.png)

Press any key on your keyboard, and then select **Enroll MOK**.

:::note
If the **Enroll MOK** entry is not shown, select **Enroll key from disk** and search for **MOK.cer** file inside the directory with long string and, inside of it, enter into **EFI/Athena** directory and select the Athena Secure Boot **.cer** file.
:::

![MOK Enroll](@assets/images/mok-enroll.png)

Press on **Continue**.

![MOK Continue](@assets/images/mok-continue.png)

Press on **Yes** to confirm the enrollment.

![MOK Confirm](@assets/images/mok-confirm.png)

Insert the root password you defined during the installation.

![MOK Password](@assets/images/mok-password.png)

Finally, select **Reboot**.

![MOK Reboot](@assets/images/mok-reboot.png)

After reboot, you should be able to access to Athena through Secure Boot.

Once you land on Athena environment, you can remove the MOK certificate from EFI partition:
```shell
sudo rm -rf /boot/efi/EFI/MOK.cer
```

:::caution
**/etc/secureboot/keys/MOK.key** is used to sign boot files. It has restricted permission. Don't delete it. If you delete it, to access to the system, you must disable Secure Boot from BIOS if you have the grants to access to it.
:::

## File Revalidation

During the updates of packages involving kernel, files signed by Secure Boot key could change and be not valid and trusted anymore. So, they need to be signed again.

Athena OS performs signing automatically for you, but in the worst scenario these files are not re-validated, and at boot you get an error like **policy violated**, you can boot by ISO Live Environment, mount the root and boot partitions to their proper mount points and run:
```shell
sudo arch-chroot /mnt

sbsign --key /etc/secureboot/keys/MOK.key --cert /etc/secureboot/keys/MOK.crt --output /boot/efi/EFI/systemd/systemd-bootx64.efi /boot/efi/EFI/systemd/systemd-bootx64.efi
cp /boot/efi/EFI/systemd/systemd-bootx64.efi /boot/efi/EFI/BOOT/grubx64.efi

ukify build --linux /boot/vmlinuz-linux-lts --initrd /boot/initramfs-linux-lts.img --cmdline <list of kernel params> --os-release /usr/lib/os-release --uname linux-lts --signtool=sbsign --secureboot-private-key /etc/secureboot/keys/MOK.key --secureboot-certificate /etc/secureboot/keys/MOK.crt --output /boot/efi/EFI/Athena/linux-lts.efi

ukify build --linux /boot/vmlinuz-linux-hardened --initrd /boot/initramfs-linux-hardened.img --cmdline <list of kernel params> --os-release /usr/lib/os-release --uname linux-hardened --signtool=sbsign --secureboot-private-key /etc/secureboot/keys/MOK.key --secureboot-certificate /etc/secureboot/keys/MOK.crt --output /boot/efi/EFI/Athena/linux-hardened.efi
```

## TPM Measurements

In Athena OS, Secure Boot is tightly integrated with the TPM to strengthen system integrity verification.

During boot, the **Secure Boot state and certificates** are measured by the firmware and stored in the TPM’s
**Platform Configuration Registers (PCRs)**, specifically **PCR 7** and **PCR 9**.

- **PCR 7** records the Secure Boot policy itself, the platform and key database (**PK**, **KEK**, and **db**) used to validate EFI binaries.
- **PCR 9** records additional Secure Boot–related data measured by the kernel and EFI environment, including **EFI Load Options** and **initramfs integrity**, ensuring the kernel and its boot parameters match a trusted state.

When LUKS encryption is bound to the TPM (for example, through **systemd-cryptenroll**),
these PCR values become part of the unsealing policy.  
That means:
- If Secure Boot is disabled, modified, or an untrusted bootloader/kernel is used, the PCR measurements will change.
- The TPM will then **refuse to release the decryption key**, prompting for your manual LUKS passphrase instead.

This link between Secure Boot and TPM guarantees that only some specific measured systems (verified and trusted) boots and automatically unlock encrypted volumes.

:::tip
It is strongly suggested to protect your BIOS authentication by a **PIN** or **strong password** to prevent that an unauthorized actor can disable the Secure Boot.
:::

<ImageComponent />
